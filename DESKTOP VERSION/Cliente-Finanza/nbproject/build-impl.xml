<?xml version="1.0" encoding="UTF-8"?>
<project xmlns:j2seproject1="http://www.netbeans.org/ns/j2se-project/1" 
         xmlns:j2seproject3="http://www.netbeans.org/ns/j2se-project/3" 
         xmlns:jaxrpc="http://www.netbeans.org/ns/j2se-project/jax-rpc" 
         basedir=".." 
         default="default" 
         name="Cliente-Finanza-impl">
    
    <fail message="Please build using Ant 1.8.0 or higher.">
        <condition>
            <not>
                <antversion atleast="1.8.0"/>
            </not>
        </condition>
    </fail>
    
    <property file="nbproject/private/private.properties"/>
    <property file="nbproject/project.properties"/>
    
    <property name="application.title" value="Cliente-Finanza"/>
    <property name="application.vendor" value="Finanza"/>
    <property name="main.class" value="ui.FinanzaDesktop"/>
    
    <condition property="have.sources">
        <available file="${src.dir}"/>
    </condition>
    
    <!-- Basic properties -->
    <property name="build.dir" value="build"/>
    <property name="build.classes.dir" value="${build.dir}/classes"/>
    <property name="dist.dir" value="dist"/>
    <property name="dist.jar" value="${dist.dir}/${application.title}.jar"/>
    <property name="src.dir" value="src"/>
    
    <!-- Classpath with dependencies -->
    <path id="javac.classpath">
        <fileset dir="lib" includes="*.jar" erroronmissingdir="false"/>
    </path>
    
    <path id="run.classpath">
        <path refid="javac.classpath"/>
        <pathelement location="${build.classes.dir}"/>
    </path>
    
    <!-- Targets -->
    <target name="default" depends="jar" description="Build whole project."/>
    
    <target name="init">
        <mkdir dir="${build.dir}"/>
        <mkdir dir="${build.classes.dir}"/>
        <mkdir dir="${dist.dir}"/>
        <mkdir dir="lib"/>
    </target>
    
    <target name="download-dependencies" unless="dependencies.downloaded">
        <echo message="Downloading SQLite JDBC driver..."/>
        <get src="https://repo1.maven.org/maven2/org/xerial/sqlite-jdbc/3.42.0.0/sqlite-jdbc-3.42.0.0.jar"
             dest="lib/sqlite-jdbc-3.42.0.0.jar"
             usetimestamp="true"
             skipexisting="true"/>
        
        <echo message="Downloading NetBeans AbsoluteLayout library..."/>
        <get src="https://repo1.maven.org/maven2/org/netbeans/external/AbsoluteLayout/RELEASE126/AbsoluteLayout-RELEASE126.jar"
             dest="lib/AbsoluteLayout-RELEASE126.jar"
             usetimestamp="true"
             skipexisting="true"/>
        
        <property name="dependencies.downloaded" value="true"/>
    </target>

    <target name="compile" depends="init, download-dependencies" if="have.sources">
        <javac srcdir="${src.dir}" 
               destdir="${build.classes.dir}" 
               debug="true" 
               encoding="UTF-8"
               source="15"
               target="15"
               includeantruntime="false">
            <classpath refid="javac.classpath"/>
        </javac>
        <copy todir="${build.classes.dir}">
            <fileset dir="${src.dir}" excludes="**/*.java"/>
        </copy>
    </target>
    
    <target name="jar" depends="compile">
        <jar jarfile="${dist.jar}" compress="true">
            <fileset dir="${build.classes.dir}"/>
            <manifest>
                <attribute name="Main-Class" value="${main.class}"/>
                <attribute name="Class-Path" value="lib/sqlite-jdbc-3.42.0.0.jar lib/AbsoluteLayout-RELEASE126.jar"/>
            </manifest>
        </jar>
    </target>
    
    <target name="run" depends="compile">
        <java classname="${main.class}" fork="true">
            <classpath refid="run.classpath"/>
        </java>
    </target>
    
    <target name="clean" description="Clean build products.">
        <delete dir="${build.dir}"/>
        <delete dir="${dist.dir}"/>
    </target>
    
    <target name="clean-all" depends="clean" description="Clean all build products including dependencies.">
        <delete dir="lib"/>
    </target>
    
</project>